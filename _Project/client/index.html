<!DOCTYPE html>

<html>
	<head>
		<script src=
			"https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js">
		</script>
		<style>
			html, body{
				margin: 0px;
			}

			canvas{
				display:block;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<script>
			var socket = io();
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');
			width = canvas.width = window.innerWidth;
			height = canvas.height = window.innerHeight;
			
			var cols = 15;
			var rows = 9;
			
			var colWidth = width / cols;
			var rowHeight = height / rows;
			
			socket.on('update', function(data){
				
				//clear the screen
				ctx.clearRect(0, 0, width, height);
				
				//draw the players
				for(var i = 0; i < data.length; i++){
					//draw the background
					var x = 0;
					var y = 0;
					var swap = true;
					for(var j = 0; j < rows; j++){
						for(var k = 0; k < cols; k++){
							if(swap){
								ctx.fillStyle = data[i].roomColor;
								swap = false;
							} else if(!swap){
								ctx.fillStyle = 'white';
								swap = true;
							}

							ctx.fillRect(x, y, colWidth, rowHeight);
							x += colWidth;
						}
						y += rowHeight;
						x = 0;
					}	
					
					//Draw the player
					ctx.beginPath();
					ctx.arc(data[i].x, data[i].y, 25, 0, 2*Math.PI, false);
					ctx.fillStyle = data[i].color;
					ctx.fill();
				}
				
				//check if the player is off the screen
				
			});
			
			window.addEventListener('keydown', function(event){
				if(event.keyCode === 68)  //d
					socket.emit('keypress', {inputId: 'right', state: true});
				if(event.keyCode === 83)  //s
					socket.emit('keypress', {inputId: 'down', state: true});
				if(event.keyCode === 65)  //a
					socket.emit('keypress', {inputId: 'left', state: true});
				if(event.keyCode === 87)  //w
					socket.emit('keypress', {inputId: 'up', state: true});
				if(event.keyCode === 74)  //j
					socket.emit('join', 1);
			});
			
			window.addEventListener('keyup', function(event){
				if(event.keyCode === 68)  //d
					socket.emit('keypress', {inputId: 'right', state: false});
				if(event.keyCode === 83)  //s
					socket.emit('keypress', {inputId: 'down', state: false});
				if(event.keyCode === 65)  //a
					socket.emit('keypress', {inputId: 'left', state: false});
				if(event.keyCode === 87)  //w
					socket.emit('keypress', {inputId: 'up', state: false});
			});
			
		</script>
	</body>
</html>