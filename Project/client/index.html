<!DOCTYPE html>

<html>
	<head>
		<script src=
		"https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js">
		</script>
		<script src="client/js/vector.js"></script>
		<script src="client/js/particle.js"></script>
		<script src="client/js/player.js"></script>


		<style>
			html, body{
				margin: 0px;
			}

			canvas{
				display:block;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		
		<script>
		var socket = io()
		var context;
		var PLAYER;
		var players = [];
		var cols = 17;//15
		var rows = 9;//8

		window.onload = function(){
			var canvas = document.getElementById('canvas');
			context = canvas.getContext('2d');
			width = canvas.width = window.innerWidth;
			height = canvas.height = window.innerHeight;
			
			//requestFullScreen(canvas);
			
			update();
			
			function update(){
				context.clearRect(0, 0, width, height);
				//Do stuff---------
				if(player.id){
					PLAYER.draw(context);
				}
				
				for(var i in players){
					if(players[i].id){
						players[i].draw(context);
					}
				}
				
				var x = 0;
				for(var i = 0; i < cols; i++){
					context.beginPath();
					context.lineWidth = 5;
					context.strokeStyle = '#000000';
					context.moveTo(x,0);
					context.lineTo(x,canvas.height);
					context.stroke();
					x += canvas.width / cols;
				}
				
				var y = 0;
				for(var i = 0; i < rows; i++){
					context.beginPath();
					context.lineWidth = 5;
					context.strokeStyle = '#000000';
					context.moveTo(0,y);
					context.lineTo(canvas.width,y);
					context.stroke();
					y += canvas.height / rows;
				}
				
				
				//-----------------
				requestAnimationFrame(update);
			}
		};
			
		socket.on('playerCreated', function(data){
			PLAYER = player.create(data.id);
			PLAYER.x = data.x;
			PLAYER.y = data.y;
			PLAYER.color = data.color;
		});
			
		socket.on('updateSelf', function(data){
			PLAYER.x = data.x;
			PLAYER.y = data.y;
			PLAYER.color = data.color;
		});
			
		socket.on('updateOthers', function(data){
			players = [];
			for(var i = 0; i < data.length; i++){
				var player = player.create(data[i].id);
				player.x = data[i].x;
				player.y = data[i].y;
				player.color = data[i].color;
				players.push(player);
			}
			console.log(players);
		});
			
		/*socket.on('update', function(data){
			PLAYER.players = [];
			for(var i = 0; i < data.length; i++){
				console.log(data[i].id);
				if(data[i].id === PLAYER.id){
					PLAYER.x = data[i].x;
					PLAYER.y = data[i].y;
					PLAYER.color = data[i].color;
				} else {
					var p = player.create(data[i].id);
					p.x = data[i].x;
					p.y = data[i].y;
					p.color = data[i].color;
					PLAYER.players.push(p);
				}
			}
		});*/
			
		document.onkeydown = function(event){
			if(event.keyCode === 68)  //d
				socket.emit('keypress', {inputId: 'right', state: true});
			if(event.keyCode === 83)  //s
				socket.emit('keypress', {inputId: 'down', state: true});
			if(event.keyCode === 65)  //a
				socket.emit('keypress', {inputId: 'left', state: true});
			if(event.keyCode === 87)  //w
				socket.emit('keypress', {inputId: 'up', state: true});
			
			if(event.keyCode === 74){
				socket.emit('connectPlayers', null);
				console.log('j');
			}
		}
		
		document.onkeyup = function(event){
			if(event.keyCode === 68)  //d
				socket.emit('keypress', {inputId: 'right', state: false});
			if(event.keyCode === 83)  //s
				socket.emit('keypress', {inputId: 'down', state: false});
			if(event.keyCode === 65)  //a
				socket.emit('keypress', {inputId: 'left', state: false});
			if(event.keyCode === 87)  //w
				socket.emit('keypress', {inputId: 'up', state: false});
		}
		
		/*function requestFullScreen(element) {
    // Supports most browsers and their versions.
    var requestMethod = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullScreen;

    if (requestMethod) { // Native full screen.
        requestMethod.call(element);
    } else if (typeof window.ActiveXObject !== "undefined") { // Older IE.
        var wscript = new ActiveXObject("WScript.Shell");
        if (wscript !== null) {
            wscript.SendKeys("{F11}");
        }
    }
}

var elem = document.body; // Make the body go full screen.
requestFullScreen(elem);*/
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
</script>
	</body>
</html>